import React, { useState, useEffect } from 'react';

/**
 * Dashboard Component - Trang ch·ªß hi·ªÉn th·ªã t·ªïng quan
 * 
 * Concepts t·ª´ Day 1-7:
 * - Components & Props (Day 2): Nh·∫≠n v√† s·ª≠ d·ª•ng props
 * - State Management (Day 4): Qu·∫£n l√Ω state c·ªßa dashboard
 * - Event Handling (Day 5): X·ª≠ l√Ω c√°c events t∆∞∆°ng t√°c
 * - Conditional Rendering (Day 3 & 6): Hi·ªÉn th·ªã n·ªôi dung d·ª±a tr√™n ƒëi·ªÅu ki·ªán
 * - Advanced Lists (Day 7): Render danh s√°ch courses, activities
 * - useEffect Hook: Fetch data khi component mount
 */

const Dashboard = ({ 
  currentUser,        // Props: th√¥ng tin user hi·ªán t·∫°i (Day 2)
  userProgress,       // Props: ti·∫øn ƒë·ªô h·ªçc t·∫≠p (Day 2)
  onCourseClick,      // Props: function x·ª≠ l√Ω click course (Day 2)
  onActivityClick     // Props: function x·ª≠ l√Ω click activity (Day 2)
}) => {
  
  /**
   * State Management (Day 4): Qu·∫£n l√Ω state c·ªßa dashboard
   */
  const [recentActivities, setRecentActivities] = useState([]); // Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y
  const [recommendedCourses, setRecommendedCourses] = useState([]); // Kh√≥a h·ªçc ƒë·ªÅ xu·∫•t
  const [todayStats, setTodayStats] = useState(null); // Th·ªëng k√™ h√¥m nay
  const [isLoading, setIsLoading] = useState(true); // Tr·∫°ng th√°i loading
  const [currentTime, setCurrentTime] = useState(new Date()); // Th·ªùi gian hi·ªán t·∫°i

  /**
   * useEffect Hook: Fetch data khi component mount
   * Side Effects (Advanced): T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu
   */
  useEffect(() => {
    // Simulate API call ƒë·ªÉ load dashboard data
    const loadDashboardData = async () => {
      setIsLoading(true);
      
      try {
        // Simulate loading delay
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Mock data cho recent activities
        setRecentActivities([
          {
            id: 1,
            type: 'lesson_completed',
            title: 'Ho√†n th√†nh b√†i h·ªçc "React Components"',
            course: 'React Fundamentals',
            time: '2 gi·ªù tr∆∞·ªõc',
            icon: '‚úÖ'
          },
          {
            id: 2,
            type: 'exercise_submitted',
            title: 'N·ªôp b√†i t·∫≠p "State Management"',
            course: 'React Advanced',
            time: '4 gi·ªù tr∆∞·ªõc',
            icon: 'üìù'
          },
          {
            id: 3,
            type: 'achievement_unlocked',
            title: 'ƒê·∫°t th√†nh t√≠ch "React Master"',
            course: 'General',
            time: '1 ng√†y tr∆∞·ªõc',
            icon: 'üèÜ'
          },
          {
            id: 4,
            type: 'discussion_participated',
            title: 'Tham gia th·∫£o lu·∫≠n "Best Practices"',
            course: 'React Community',
            time: '2 ng√†y tr∆∞·ªõc',
            icon: 'üí¨'
          }
        ]);

        // Mock data cho recommended courses
        setRecommendedCourses([
          {
            id: 1,
            title: 'Advanced React Patterns',
            description: 'H·ªçc c√°c pattern n√¢ng cao trong React',
            progress: 0,
            duration: '8 tu·∫ßn',
            level: 'N√¢ng cao',
            instructor: 'Nguy·ªÖn VƒÉn A',
            thumbnail: 'üöÄ'
          },
          {
            id: 2,
            title: 'React Testing Library',
            description: 'C√°ch test React components hi·ªáu qu·∫£',
            progress: 25,
            duration: '4 tu·∫ßn',
            level: 'Trung c·∫•p',
            instructor: 'Tr·∫ßn Th·ªã B',
            thumbnail: 'üß™'
          },
          {
            id: 3,
            title: 'React Native Mobile',
            description: 'Ph√°t tri·ªÉn ·ª©ng d·ª•ng mobile v·ªõi React Native',
            progress: 0,
            duration: '10 tu·∫ßn',
            level: 'N√¢ng cao',
            instructor: 'L√™ VƒÉn C',
            thumbnail: 'üì±'
          }
        ]);

        // Mock data cho today stats
        setTodayStats({
          lessonsCompleted: 3,
          timeSpent: 120, // minutes
          exercisesSubmitted: 2,
          pointsEarned: 150
        });

      } catch (error) {
        console.error('Error loading dashboard data:', error);
      } finally {
        setIsLoading(false);
      }
    };

    loadDashboardData();
  }, []); // Empty dependency array - ch·ªâ ch·∫°y m·ªôt l·∫ßn khi mount

  /**
   * useEffect Hook: Update th·ªùi gian hi·ªán t·∫°i m·ªói gi√¢y
   * Side Effects (Advanced): Real-time clock
   */
  useEffect(() => {
    const timer = setInterval(() => {
      setCurrentTime(new Date());
    }, 1000);

    // Cleanup function ƒë·ªÉ clear interval khi component unmount
    return () => clearInterval(timer);
  }, []); // Empty dependency array

  /**
   * Event Handling (Day 5): X·ª≠ l√Ω click v√†o course
   */
  const handleCourseClick = (course) => {
    console.log('Course clicked:', course.title); // Debug log
    onCourseClick && onCourseClick(course);
  };

  /**
   * Event Handling (Day 5): X·ª≠ l√Ω click v√†o activity
   */
  const handleActivityClick = (activity) => {
    console.log('Activity clicked:', activity.title); // Debug log
    onActivityClick && onActivityClick(activity);
  };

  /**
   * Utility function: Format th·ªùi gian
   * Advanced Lists (Day 7): Helper function cho display
   */
  const formatTime = (date) => {
    return date.toLocaleTimeString('vi-VN', {
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });
  };

  /**
   * Utility function: Format date
   */
  const formatDate = (date) => {
    return date.toLocaleDateString('vi-VN', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  };

  /**
   * Utility function: T√≠nh ph·∫ßn trƒÉm progress
   */
  const calculateOverallProgress = () => {
    if (!userProgress) return 0;
    const total = userProgress.totalLessons || 1;
    const completed = userProgress.completedLessons || 0;
    return Math.round((completed / total) * 100);
  };

  /**
   * Utility function: L·∫•y l·ªùi ch√†o d·ª±a tr√™n th·ªùi gian
   */
  const getGreeting = () => {
    const hour = currentTime.getHours();
    if (hour < 12) return 'Ch√†o bu·ªïi s√°ng';
    if (hour < 18) return 'Ch√†o bu·ªïi chi·ªÅu';
    return 'Ch√†o bu·ªïi t·ªëi';
  };

  // Conditional Rendering (Day 3): Hi·ªÉn th·ªã loading state
  if (isLoading) {
    return (
      <div className="dashboard loading">
        <div className="loading-spinner">
          <span>üìö</span>
          <p>ƒêang t·∫£i dashboard...</p>
        </div>
      </div>
    );
  }

  return (
    // JSX (Day 1): C·∫•u tr√∫c dashboard
    <div className="dashboard">
      
      {/* Welcome Section */}
      <section className="welcome-section">
        <div className="welcome-content">
          <h1 className="welcome-title">
            {/* JSX (Day 1): Embedding expressions */}
            {getGreeting()}, {currentUser?.name || 'H·ªçc vi√™n'}! üëã
          </h1>
          <p className="welcome-subtitle">
            H√¥m nay l√† {formatDate(currentTime)} - {formatTime(currentTime)}
          </p>
          <p className="welcome-message">
            S·∫µn s√†ng ti·∫øp t·ª•c h√†nh tr√¨nh h·ªçc React c·ªßa b·∫°n ch∆∞a?
          </p>
        </div>
        
        <div className="welcome-stats">
          <div className="overall-progress">
            <h3>Ti·∫øn ƒë·ªô t·ªïng th·ªÉ</h3>
            <div className="progress-circle">
              <span className="progress-percentage">{calculateOverallProgress()}%</span>
            </div>
            <p>{userProgress?.completedLessons || 0} / {userProgress?.totalLessons || 0} b√†i h·ªçc</p>
          </div>
        </div>
      </section>

      {/* Today's Stats */}
      {/* Conditional Rendering (Day 6): Hi·ªÉn th·ªã stats n·∫øu c√≥ data */}
      {todayStats && (
        <section className="today-stats">
          <h2>Th·ªëng k√™ h√¥m nay</h2>
          <div className="stats-grid">
            <div className="stat-card">
              <span className="stat-icon">üìñ</span>
              <div className="stat-content">
                <span className="stat-number">{todayStats.lessonsCompleted}</span>
                <span className="stat-label">B√†i h·ªçc ho√†n th√†nh</span>
              </div>
            </div>
            
            <div className="stat-card">
              <span className="stat-icon">‚è±Ô∏è</span>
              <div className="stat-content">
                <span className="stat-number">{todayStats.timeSpent}</span>
                <span className="stat-label">Ph√∫t h·ªçc t·∫≠p</span>
              </div>
            </div>
            
            <div className="stat-card">
              <span className="stat-icon">üí™</span>
              <div className="stat-content">
                <span className="stat-number">{todayStats.exercisesSubmitted}</span>
                <span className="stat-label">B√†i t·∫≠p n·ªôp</span>
              </div>
            </div>
            
            <div className="stat-card">
              <span className="stat-icon">‚≠ê</span>
              <div className="stat-content">
                <span className="stat-number">{todayStats.pointsEarned}</span>
                <span className="stat-label">ƒêi·ªÉm ki·∫øm ƒë∆∞·ª£c</span>
              </div>
            </div>
          </div>
        </section>
      )}

      {/* Main Content Grid */}
      <div className="dashboard-grid">
        
        {/* Recommended Courses */}
        <section className="recommended-courses">
          <div className="section-header">
            <h2>Kh√≥a h·ªçc ƒë·ªÅ xu·∫•t</h2>
            <button className="view-all-btn">Xem t·∫•t c·∫£</button>
          </div>
          
          <div className="courses-grid">
            {/* Advanced Lists (Day 7): Render recommended courses */}
            {recommendedCourses.map(course => (
              <div 
                key={course.id}
                className="course-card"
                onClick={() => handleCourseClick(course)}
              >
                <div className="course-thumbnail">
                  <span className="course-icon">{course.thumbnail}</span>
                </div>
                
                <div className="course-content">
                  <h3 className="course-title">{course.title}</h3>
                  <p className="course-description">{course.description}</p>
                  
                  <div className="course-meta">
                    <span className="course-duration">üìÖ {course.duration}</span>
                    <span className="course-level">üéØ {course.level}</span>
                  </div>
                  
                  <div className="course-instructor">
                    üë®‚Äçüè´ {course.instructor}
                  </div>
                  
                  {/* Conditional Rendering (Day 3): Hi·ªÉn th·ªã progress n·∫øu ƒë√£ b·∫Øt ƒë·∫ßu */}
                  {course.progress > 0 ? (
                    <div className="course-progress">
                      <div className="progress-bar">
                        <div 
                          className="progress-fill"
                          style={{ width: `${course.progress}%` }}
                        />
                      </div>
                      <span className="progress-text">{course.progress}% ho√†n th√†nh</span>
                    </div>
                  ) : (
                    <button className="start-course-btn">
                      B·∫Øt ƒë·∫ßu h·ªçc
                    </button>
                  )}
                </div>
              </div>
            ))}
          </div>
        </section>

        {/* Recent Activities */}
        <section className="recent-activities">
          <div className="section-header">
            <h2>Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h2>
            <button className="view-all-btn">Xem t·∫•t c·∫£</button>
          </div>
          
          <div className="activities-list">
            {/* Advanced Lists (Day 7): Render recent activities */}
            {recentActivities.map(activity => (
              <div 
                key={activity.id}
                className={`activity-item ${activity.type}`}
                onClick={() => handleActivityClick(activity)}
              >
                <span className="activity-icon">{activity.icon}</span>
                
                <div className="activity-content">
                  <h4 className="activity-title">{activity.title}</h4>
                  <p className="activity-course">{activity.course}</p>
                  <span className="activity-time">{activity.time}</span>
                </div>
              </div>
            ))}
          </div>
          
          {/* Conditional Rendering (Day 6): Hi·ªÉn th·ªã message n·∫øu kh√¥ng c√≥ activities */}
          {recentActivities.length === 0 && (
            <div className="no-activities">
              <span className="no-activities-icon">üìù</span>
              <p>Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o g·∫ßn ƒë√¢y</p>
              <p>H√£y b·∫Øt ƒë·∫ßu h·ªçc m·ªôt kh√≥a h·ªçc m·ªõi!</p>
            </div>
          )}
        </section>
      </div>

      {/* Quick Actions */}
      <section className="quick-actions">
        <h2>H√†nh ƒë·ªông nhanh</h2>
        <div className="actions-grid">
          <button className="action-btn" onClick={() => console.log('Start lesson clicked')}>
            <span className="action-icon">üìñ</span>
            <span className="action-text">B·∫Øt ƒë·∫ßu b√†i h·ªçc</span>
          </button>
          
          <button className="action-btn" onClick={() => console.log('Practice exercise clicked')}>
            <span className="action-icon">üí™</span>
            <span className="action-text">Luy·ªán t·∫≠p</span>
          </button>
          
          <button className="action-btn" onClick={() => console.log('Join discussion clicked')}>
            <span className="action-icon">üí¨</span>
            <span className="action-text">Tham gia th·∫£o lu·∫≠n</span>
          </button>
          
          <button className="action-btn" onClick={() => console.log('View progress clicked')}>
            <span className="action-icon">üìä</span>
            <span className="action-text">Xem ti·∫øn ƒë·ªô</span>
          </button>
        </div>
      </section>
      
    </div>
  );
};

export default Dashboard;